!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).signalR={})}(this,(function(e){"use strict";function t(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}var n;!function(e){e[e.None=0]="None",e[e.Trace=1]="Trace",e[e.Debug=2]="Debug",e[e.Information=3]="Information",e[e.Warning=4]="Warning",e[e.Error=5]="Error",e[e.Critical=6]="Critical"}(n||(n={}));var r=n,i=function(){function e(e){this.loggers=[];var t=this;this.isEnabled=function(e){return e>=t.minimumLogLevel}}return e.prototype.log=function(e,t){this.isEnabled(e)&&this.loggers.forEach((function(n){n(e,t)}))},e}(),o=function(){function e(e,t){this.connection=e,this._logger=t,this._methods=new Map,this._invocationId=0,this._callbacks=new Map,this._handlers=new Map,this._closedCallbacks=[],this._beforeCloseCallbacks=[],this.connection.onclose((function(t){return e._stopConnection(t)}))}return e.prototype._stopConnection=function(e){var t=this;this._logger.log(r.Debug,"HubConnection.stopConnection("+e+") called while in state "+this.connection.state+"."),this.connection.transport=void 0,Error.captureStackTrace&&(this._callbackErrors={}),this._invoke("beforeClose",e).catch((function(e){t._logger.log(r.Error,"Error occurred when closing hub connection: "+e)})),this._cleanupTimeout(),this._cleanupPingTimer(),this.connection.stop(e).catch((function(e){t._logger.log(r.Error,"Error occurred during connection stop: "+e)}))},e.prototype._cleanupPingTimer=function(){this._pingServerHandle&&clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0},e.prototype._cleanupTimeout=function(){this._timeoutHandle&&clearTimeout(this._timeoutHandle),this._timeoutHandle=void 0},e.prototype._createInvocation=function(e,t,n){return void 0!==n&&null!==n?{arguments:t,headers:{},invocationId:n,streamIds:[],target:e,type:3}:{arguments:t,headers:{},target:e,type:1}},e.prototype._createStreamInvocation=function(e,t,n){return{arguments:t,headers:{},invocationId:n,streamIds:[],target:e,type:4}},e.prototype._createCancelInvocation=function(e){return{headers:{},invocationId:e,type:5}},e.prototype.onclose=function(e){return e&&this._closedCallbacks.push(e),this},e.prototype.onreconnected=function(e){return e&&this._reconnectedCallbacks.push(e),this},e.prototype.onreconnecting=function(e){return e&&this._reconnectingCallbacks.push(e),this},e.prototype.beforeClose=function(e){return e&&this._beforeCloseCallbacks.push(e),this},e.prototype._invoke=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=this._callbacks.get(e);if(i)try{i.apply(this,n.concat([t]))}catch(e){this._logger.log(r.Error,"Callback for "+t+" failed: "+e)}return Promise.resolve()},e.prototype._connection=function(){var e=this.connection;if(!e)throw new Error("HubConnection failed to initialize.");return e},e.prototype._resetTimeoutPeriod=function(){var e=this;this._timeoutHandle&&clearTimeout(this._timeoutHandle),this._timeoutHandle=setTimeout((function(){e._logger.log(r.Warning,"Server timeout elapsed without receiving a message from the server."),e.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}),this.serverTimeoutInMilliseconds)},e.prototype._resetKeepAliveInterval=function(){var e=this;this._pingServerHandle&&clearTimeout(this._pingServerHandle),this._pingServerHandle=setTimeout((function(){return t(e,void 0,void 0,(function(){var e,t,i,o,s;return n(this,(function(n){switch(n.label){case 0:if(this.connection.state!==2)return[2];e="",n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._sendMessage(this._cachedPingMessage)];case 2:return n.sent(),[3,4];case 3:return t=n.sent(),this._logger.log(r.Error,"Error sending ping message: "+t),e=t,[3,4];case 4:if(i=Date.now()-this._lastMessageReceivedTimestamp,o=this.keepAliveIntervalInMilliseconds+this.serverTimeoutInMilliseconds,i>=o)return this._logger.log(r.Warning,"Server timeout elapsed without receiving a message from the server."),void this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."));e&&(s=this.connection.state===2?this.serverTimeoutInMilliseconds-i:this.keepAliveIntervalInMilliseconds),s>0?(this._logger.log(r.Information,"Ping timed out. Restarting the ping timer in "+s+" ms"),this._pingServerHandle=setTimeout((function(){return e._resetKeepAliveInterval()}),s)):(this._logger.log(r.Information,"Ping timed out"),this._resetKeepAliveInterval()),[2]}}))}))}),this.keepAliveIntervalInMilliseconds)},e}(),s=function(){function e(e,t,n,i){var o=this;this._retryDelays=e,this._connectionState=2,this._connectionStarted=!1,this._httpClient=t,this._logger=n,this._options=i,this.onreceive=null,this.onclose=null,this._initializePromise=this._initialize(),this._startPromise=new Promise((function(e,t){o._startPromiseResolver=e,o._startPromiseRejecter=t}))}return e.prototype._initialize=function(){return t(this,void 0,void 0,(function(){var e,t;return n(this,(function(n){switch(n.label){case 0:return[4,this._detectTransport()];case 1:return e=n.sent(),this._transport=this._constructTransport(e),this.connectionId=null,this._negotiateResponse=null,[4,this._startTransport()];case 2:if(n.sent(),this.connectionId=null,this.connectionId=this._negotiateResponse.connectionId,this._connectionState=0,t=this._negotiateResponse.availableTransports||[],!this._negotiateResponse.accessToken||0===t.length&&!this._options._useStatefulReconnection)return[3,4];this._accessTokenFactory=function(){return o._negotiateResponse.accessToken},n.label=3;case 3:n.label=4;case 4:return[2]}var o=this}))}))}},s}(),a=function(){function e(){}return e}();class c extends a{constructor(){super()}}const u=new class extends a{};class l extends a{getNextRetryDelayInMilliseconds(e){return void 0===e||e.previousRetryCount<0?0:Math.random()*(Math.pow(2,e.previousRetryCount+1)-1)*1e3}} 